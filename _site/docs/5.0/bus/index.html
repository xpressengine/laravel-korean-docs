<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>커맨드 버스(Command Bus)</title>
  <meta name="description" content="라라벨 한글 메뉴얼에 대한 메뉴얼 페이지입니다.">

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="/laravel-korean-docs/js/prism.js"></script>
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/xeicon/1.0.4/xeicon.min.css">
  <link rel="stylesheet" href="/laravel-korean-docs/css/layout.css">
  <link rel="canonical" href="http://www.xpressengine.com/laravel-korean-docs/docs/5.0/bus/">
</head>


  <body>

    <div class="container">
    <header>
        <div class="wrap">
            <h1 class="logo"><a href="/laravel-korean-docs/">Laravel korean docs <small>laravel 한글 매뉴얼</small></a></h1>
            <div class="btn_area">
                <a class="button" href="https://github.com/xpressengine/laravel-korean-docs/tree/kr-5.0/kr">View on Github</a>
                <a class="button" href="https://github.com/xpressengine/laravel-korean-docs/archive/kr-5.0.zip">Download.zip</a>
                <a class="button" href="https://github.com/xpressengine/laravel-korean-docs.git">Git Repository</a>
            </div>
        </div>
    </header>
    <div class="supported">
        <div class="wrap">
            <a class="bnr" href="http://www.xpressengine.com"><img src="/laravel-korean-docs/img/bnr1.png" /></a><a class="bnr" href="http://dev.naver.com/d2"><img src="/laravel-korean-docs/img/bnr2.png" /></a><a class="bnr" href="http://xpressengine.github.io/XEIcon/"><img src="/laravel-korean-docs/img/bnr3.png" /></a><a class="bnr" href="http://xpressengine.github.io/Composer-korean-docs/"><img src="/laravel-korean-docs/img/bnr4.png" /></a><a class="bnr" href="http://laravel.com/"><img src="/laravel-korean-docs/img/bnr5.png" /></a>
        </div>
    </div>
    <div class="body docs">
        <div class="wrap">
            <section class="sidebar">
            <ul>
    <li>Prologue
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/upgrade">업그레이드 가이드</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/contributions">기여 가이드</a></li>
        </ul>
    </li>
    <li>Setup
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/installation">설치하기</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/configuration">설정</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/homestead">라라벨 홈스테드</a></li>
        </ul>
    </li>
    <li>The Basics
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/routing">HTTP 라우팅</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/middleware">HTTP 미들웨어</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/controllers">HTTP 컨트롤러</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/requests">Requests</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/responses">Responses</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/views">뷰-Views</a></li>
        </ul>
    </li>
    <li>Architecture Foundations
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/providers">서비스 프로바이더</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/container">서비스 컨테이너</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/contracts">Contracts</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/facades">파사드</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/lifecycle">라이프사이클</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/structure">어플리케이션 구조</a></li>
        </ul>
    </li>
    <li>Services
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/authentication">인증</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/billing">라라벨 캐셔</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/cache">캐시</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/collections">컬렉션</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/bus">커맨드 버스</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/extending">프레임워크의 확장</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/elixir">라라벨 엘릭서</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/encryption">암호화</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/envoy">Envoy</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/errors">에러와 로깅</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/events">이벤트</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/filesystem">파일시스템 / 클라우드 스토리지</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/hashing">해시</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/helpers">헬퍼 함수</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/localization">지역화-다국어</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/mail">메일</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/packages">패키지 개발</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/pagination">페이지네이션</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/queues">큐</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/session">세션</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/templates">템플릿</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/testing">테스팅</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/validation">Validation</a></li>
        </ul>
    </li>
    <li>Database
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/database">기본적인 데이터 베이스 사용법</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/queries">쿼리 빌더</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/eloquent">Eloquent ORM</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/schema">스키마 빌더</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/migrations">마이그레이션과 시딩</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/redis">Redis</a></li>
        </ul>
    </li>
    <li>Artisan CLI
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/artisan">아티즌 CLI</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/commands">아티즌 명령어 개발하기</a></li>
        </ul>
    </li>
</ul>
            </section>

      <article class="content">
      <h1 id="커맨드-버스(command-bus)">커맨드 버스(Command Bus)</h1>

<ul>
<li><a href="#introduction">소개</a></li>
<li><a href="#creating-commands">커맨드 생성하기</a></li>
<li><a href="#dispatching-commands">커맨드 디스패치</a></li>
<li><a href="#queued-commands">큐 커맨드</a></li>
<li><a href="#command-pipeline">커맨드 파이프라인</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2 id="소개">소개</h2>

<p>라라벨의 커맨드 버스는 어플리케이션이 수행할 필요가 있는 작업들을 캡슐화 하는 편리한 방법을 제공합니다.커맨드 목적의 이해를 돕기 위해서, 사용자가 팟캐스트를 구매 할 수 있는 어플리케이션을 만들고 있다고 가정해봅시다.</p>

<p>사용자가 팟캐스트를 구매할 때 필요한 다양한 작업들이 있습니다. 예를 들어, 사용자의 신용 카드로 요금 청구를 하고, 데이터베이스에 구매를 나타내는  레코드를 추가하고, 구매 확인 메일을 보내야 할 것입니다. 어쩌면 우리는 사용자가 팟캐스트를 구매 할 수 있는지에 대해 어떠한 검증을 해야 할 수도 있습니다. </p>

<p>이러한 로직들을 하나의 컨트롤러 메소드에 모두 넣을 수 있지만, 그럴경우 몇가지 단점이 있습니다. 첫째로, 컨트롤러는 아마도 여러개의 각기 다른 HTTP 액션들을 처리하게 되는데, 각각의 컨트롤러 메소드가 복잡한 로직을 포함하고 있으면 컨트롤러를 비대하게 하고 읽기 어렵게 만들 것입니다. 두 번째로, 컨트롤러 외부에서 팟캐스트를 구매하는 로직을 재사용하는 것이 어렵습니다. 세 번째로, 팟캐스트 구매 로직을 테스트하기 위해 해당하는 HTTP 요청을 생성하고 응용 프로그램에 보내는 요청을 직접 수행 하지 않으면 안되기 때문에, 커맨드의 유닛 테스트가 훨씬 어려워질 것입니다.</p>

<p>컨트롤러에 이러한 로직을 넣는 것 대신, <code>PurchasePodcast</code> 커맨드와 같은 “명령어” 객체 안에 캡슐화하는 방법을 선택할 수 있습니다. </p>

<div class="chak-comment-wrap"><div class="chak-comment-widget" data-apikey="coe00da03b685a0dd18fb6a08af0923de0-laravel-korean-docs-커맨드 버스(Command Bus)-소개" ><i class="xi-message"></i> <strong>클릭</strong>하여 의견을 공유할 수 있습니다. ( 총 <span class="count"><i class="xi-spinner-5 xi-spin"></i></span>개의 의견이 있습니다. )</div></div>

<p><a name="creating-commands"></a></p>

<h2 id="커맨드-생성하기">커맨드 생성하기</h2>

<p>아티즌 CLI에서는 <code>make:command</code> 명령어를 사용하여 새로운 커맨드 클래스를 생성할 수 있습니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">php artisan make:command PurchasePodcast
</code></pre></div>
<p>새롭게 생성되는 클래스는 <code>app/Commands</code> 디렉토리에 들어갑니다. 기본적으로 커맨드는 생성자와 <code>handle</code> 메소드의 2가지 메소드를 가지고 있습니다. 물론 생성자에 <code>handle</code> 메소드에 의해서 실행되는 커맨드와 관련된 객체를 전달 할 수 있습니다. 예를 들어보겠습니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">class PurchasePodcast extends Command implements SelfHandling {

    protected $user, $podcast;

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct(User $user, Podcast $podcast)
    {
        $this-&gt;user = $user;
        $this-&gt;podcast = $podcast;
    }

    /**
     * Execute the command.
     *
     * @return void
     */
    public function handle()
    {
        // Handle the logic to purchase the podcast...

        event(new PodcastWasPurchased($this-&gt;user, $this-&gt;podcast));
    }

}
</code></pre></div>
<p>또한 <code>handle</code> 메소드에서도 타입힌트를 사용하여 <a href="/laravel-korean-docs/docs/5.0/container">서비스 컨테이너</a>가 의존 객체를 자동으로 주입할 수 있도록 할 수 있습니다. 예를 들어:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    /**
     * Execute the command.
     *
     * @return void
     */
    public function handle(BillingGateway $billing)
    {
        // Handle the logic to purchase the podcast...
    }
</code></pre></div>
<div class="chak-comment-wrap"><div class="chak-comment-widget" data-apikey="coe00da03b685a0dd18fb6a08af0923de0-laravel-korean-docs-커맨드 버스(Command Bus)-커맨드 생성하기" ><i class="xi-message"></i> <strong>클릭</strong>하여 의견을 공유할 수 있습니다. ( 총 <span class="count"><i class="xi-spinner-5 xi-spin"></i></span>개의 의견이 있습니다. )</div></div>

<p><a name="dispatching-commands"></a></p>

<h2 id="커맨드-디스패치">커맨드 디스패치</h2>

<p>이제 커맨드를 생성하였드면 어떻게 처리할 까요? 물론 직접 <code>handle</code> 메소드를 호출할 수도 있지만, 라라벨의 “커맨드 버스”를 통해서 처리하면 앞으로 이야기할 몇몇 장점들이 있습니다. </p>

<p>만약 여러분이 어플리케이션의 베이스 컨트롤러를 살펴 본다면 <code>DispatchesCommands</code> trait 를 볼 수 있습니다. 이 trait 는 어느 컨트롤러에서라도 <code>dispatch</code> 메소드를 호출할 수 있게 해줍니다. 다음 예를 살펴보겠습니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">public function purchasePodcast($podcastId)
{
    $this-&gt;dispatch(
        new PurchasePodcast(Auth::user(), Podcast::findOrFail($podcastId))
    );
}
</code></pre></div>
<p>커맨드 버스는 커맨드의 실행을 시켜주고 <code>handle</code> 메소드 에서 필요한 의존 객체들을 주입해주기 위해서 IoC 컨테이너를 호출합니다. </p>

<p>원한다면 아무 클래스에 <code>Illuminate\Foundation\Bus\DispatchesCommands</code> trait 를 추가할 수도 있습니다. 만약 어떤 클래스에서든 생성자에 커맨드 버스 인스턴스를 받고자 한다면 <code>Illuminate\Contracts\Bus\Dispatcher</code> 인터페이스를 타입힌트 하면 됩니다. 끝으로 빠르게 커맨드를 처리하기 위해서 <code>Bus</code> 파사드를 사용할수도 있습니다: </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    Bus::dispatch(
        new PurchasePodcast(Auth::user(), Podcast::findOrFail($podcastId))
    );
</code></pre></div>
<h3 id="요청으로부터-커맨드-프로퍼티-맵핑">요청으로부터 커맨드 프로퍼티 맵핑</h3>

<p>명령어로 HTTP 요청 변수를 매핑하는 것은 매우 일반적입니다. 그래서 힘들게 여러분이 각각의 요청에 일일이 작업 하게 하는대신 라라벨에서는 몇개의 헬퍼 메소드를 제공하여 처리할 수 있도록 해줍니다. <code>DispatchesCommands</code> trait 에서 사용 가능한 <code>dispatchFrom</code> 메소드를 살펴보도록 합시다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$this-&gt;dispatchFrom(&#39;Command\Class\Name&#39;, $request);
</code></pre></div>
<p>이 메서드는 주어진 커맨드 클래스의 생성자를 검사하여 HTTP 요청(또는 어떠한 다른 <code>ArrayAccess</code> 객체)으로 부터 변수를 추출할 것입니다. 만약 커맨드 클래스의 생성자에서 <code>firstName</code> 변수를 필요로 한다면 커맨드 버스는 HTTP 요청으로 부터 <code>firstName</code> 파라미터를 가져올 것입니다. </p>

<p><code>dispatchFrom</code> 메소드의 세 번째 인자로 배열을 전달할 수 있습니다. 이 배열은 HTTP 요청에서 얻을 수 없는 파라미터를 채우는데 사용됩니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$this-&gt;dispatchFrom(&#39;Command\Class\Name&#39;, $request, [
    &#39;firstName&#39; =&gt; &#39;Taylor&#39;,
]);
</code></pre></div>
<div class="chak-comment-wrap"><div class="chak-comment-widget" data-apikey="coe00da03b685a0dd18fb6a08af0923de0-laravel-korean-docs-커맨드 버스(Command Bus)-커맨드 디스패치" ><i class="xi-message"></i> <strong>클릭</strong>하여 의견을 공유할 수 있습니다. ( 총 <span class="count"><i class="xi-spinner-5 xi-spin"></i></span>개의 의견이 있습니다. )</div></div>

<p><a name="queued-commands"></a></p>

<h2 id="큐-커맨드">큐 커맨드</h2>

<p>커맨드 버스는 현재의 요청 라이프사이클동안 수행되는 동기 작업들 뿐만 아니라 라라벨의 큐작업들을 생성하기 위한 주요한 방법도 제공합니다. 그러면, 어떻게하면 커맨드 버스가 동기적 처리 대신에 백그라운드 처리를 위한 큐 작업을 실행하도록 할수 있을까요? 매우 쉽습니다. 먼저 새로운 커맨드를 생성할 때 아티즌 명령어에 <code>--queued</code> 옵션을 덧붙이면 됩니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">php artisan make:command PurchasePodcast --queued
</code></pre></div>
<p>여러분이 확인할 수 있듯이 이 옵션은 커맨드에 <code>Illuminate\Contracts\Queue\ShouldBeQueued</code> 인터페이스와 <code>SerializesModels</code> trait 기능을 추가합니다. 이 기능들은 커맨드 버스가 커맨드를 큐에 추가하도록 지시할 뿐만 아니라, 시리얼라이즈(serialize) 합니다. 그리고 커맨드의 프로퍼티로 저장된 Eloquent 모델들은 역시리얼라이즈(deserializa) 합니다. </p>

<p>만약 이미 생성한 커맨드를 큐 커맨드로 변환하고 싶다면 <code>Illuminate\Contracts\Queue\ShouldBeQueued</code> 인터페이스를 구현하도록 클래스에 수동으로 추가해주면 됩니다. 인터페이스에 어떤 메소드는 없고, 단지 디스패처에게 알리기 위한 “표시용 인터페이스” 역할을 합니다. </p>

<p>그 다음에는, 정상적으로 커맨드를 작성하면 됩니다. 커맨드가 처리될 때 버스가 자동으로 해당 커맨드를 백그라운드 처리를 위해 큐에 추가합니다. 이보다 더 쉬울 순 없습니다.</p>

<p>큐 커맨드의 상호 작용에 대한 보다 자세한 사항은 <a href="/laravel-korean-docs/docs/5.0/queues">큐 문서</a>를 참고하십시오. </p>

<div class="chak-comment-wrap"><div class="chak-comment-widget" data-apikey="coe00da03b685a0dd18fb6a08af0923de0-laravel-korean-docs-커맨드 버스(Command Bus)-큐 커맨드" ><i class="xi-message"></i> <strong>클릭</strong>하여 의견을 공유할 수 있습니다. ( 총 <span class="count"><i class="xi-spinner-5 xi-spin"></i></span>개의 의견이 있습니다. )</div></div>

<p><a name="command-pipeline"></a></p>

<h2 id="커맨드-파이프라인">커맨드 파이프라인</h2>

<p>커맨드가 핸들러에서 처리되기 전에 “파이프라인” 안에서 다른 클래스로 전달할 수 있습니다. 커맨드 파이프는 여러분의 커맨드를 제외하고, HTTP 미들웨어 처럼 동작합니다. 예를 들어 커맨드 파이프는 하나의 데이터베이스 트랜잭션 안에서 전체 커맨드 연산을 랩핑(wrap) 할 수도 있고, 간단하게 실행을 로그로 남길 수도 있습니다. </p>

<p>버스에 파이프를 추가하려면 <code>App\Providers\BusServiceProvider::boot</code>메소드에서 디스패처의 <code>pipeThrough</code> 메소드를 호출하면 됩니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$dispatcher-&gt;pipeThrough([&#39;UseDatabaseTransactions&#39;, &#39;LogCommand&#39;]);
</code></pre></div>
<p>커맨드 파이프는 미들웨어와 마찬가지로 <code>handle</code> 메소드를 정의합니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">class UseDatabaseTransactions {

    public function handle($command, $next)
    {
        return DB::transaction(function() use ($command, $next)
        {
            return $next($command);
        });
    }

}
</code></pre></div>
<p>커맨드 파이프 클래스는 <a href="/laravel-korean-docs/docs/5.0/container">IoC 컨테이너</a>를 통해서 의존성이 해결되므로 생성자에서 타입힌트를 통한 의존성을 지정할 수 있습니다. </p>

<p>커맨드 파이프에는 <code>Closure</code> 도 지정할 수 있습니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$dispatcher-&gt;pipeThrough([function($command, $next)
{
    return DB::transaction(function() use ($command, $next)
    {
        return $next($command);
    });
}]);
</code></pre></div>
<div class="chak-comment-wrap"><div class="chak-comment-widget" data-apikey="coe00da03b685a0dd18fb6a08af0923de0-laravel-korean-docs-커맨드 버스(Command Bus)-커맨드 파이프라인" ><i class="xi-message"></i> <strong>클릭</strong>하여 의견을 공유할 수 있습니다. ( 총 <span class="count"><i class="xi-spinner-5 xi-spin"></i></span>개의 의견이 있습니다. )</div></div>

      </article>

    
        </div>
    </div>
</div>
<script>
$('p a[name]').each(function(){
  var name = $(this).attr('name');
  $(this).parent().next('h2').wrapInner('<a name=' + name + '></a>');
  $(this).parent().remove();
});
$('code[class=language-text]').each(function(){
	$(this).removeClass('language-text').addClass('language-php');
});
</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
  var pageTracker = _gat._getTracker("UA-46389165-7");
pageTracker._trackPageview();
} catch(err) {}
</script>
<script type="text/javascript">
    $('.chak-comment-widget').each(function(){
        var apikey = $(this).data('apikey');
        $.ajax({
            url : "http://chak.it/index.php?act=dispCommentboxServiceCommentTotalCount&apikey=" + apikey,
            dataType : "jsonp",
            jsonp : "cb",
            success : function(data){
                $(this).find('.count').text(data.count);
            }.bind(this)
        });
    });
    $('.chak-comment-widget').click(function(){
        var apikey = $(this).data('apikey');
        var makeIframe = document.createElement("iframe");
        makeIframe.setAttribute("src", "http://chak.it/index.php?act=dispCommentboxServiceBox&apikey=" + apikey + window.location.hash);
        makeIframe.setAttribute("scrolling", "no"); makeIframe.setAttribute("data-apikey", apikey);
        makeIframe.style.border = "none"; makeIframe.style.width = "100%"; makeIframe.frameBorder = "no";
        $(this).after( makeIframe ); chakComment({}, makeIframe);

        $('.chak-comment-widget').parent().addClass('active');
        $(this).remove();
    });
</script>
<script type="text/javascript">
    (function() {
        var chak = document.createElement('script');
        chak.type = 'text/javascript'; chak.src = 'http://chak.it/static/chakComment.js'; chak.async = true;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(chak);
    })();
</script>

  </body>

</html>
